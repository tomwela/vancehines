var margin={top:25,right:0,bottom:100,left:45},width=1100-margin.left-margin.right,height=640-margin.top-margin.bottom;var tip=d3.tip().attr("class","d3-tip").offset([-15,0]).html(function(a){return"<strong>Installs:</strong> <span style='color:white'>"+a.frequency+"</span><br /><center><span>"+a.letter+"<center></span>"});var svg=d3.select("#charts").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");svg.call(tip);var format=d3.time.format("%m/%d/%Y");var today=format(d3.time.day.offset(new Date(),+1));var before=format(d3.time.day.offset(new Date(),-30));updateData("1","03/01/2014",today,mode="all");function updateData(e,c,b,d){switch(e){case"1":var a="byWeek";break;case"2":var a="byMonth";break;case"3":var a="byDay";break;default:console.log("default")}d3.json("php/installs.php?type="+a+"&d1="+c+"&d2="+b+"&mode="+d,function(l,h){var s=d3.format(",");var o=s(h.total);d3.select("#totalInstalls").text(o);if(o==0){svg.select(".x.axis").remove();svg.select(".y.axis").remove();svg.selectAll("rect").remove();d3.select("#max").text("");d3.select("#min").text("");d3.select("#mean").text("");d3.select("#median").text("");return}var j=h.results;j.forEach(function(t){t.frequency=+t.frequency});var p=d3.scale.ordinal().domain(j.map(function(t){return t.letter})).rangeRoundBands([0,width],0.1);var n=d3.scale.linear().domain([0,d3.max(j,function(t){return t.frequency*1.2})]).range([height,0]);svg.select(".x.axis").remove();svg.select(".y.axis").remove();var g=d3.svg.axis().scale(p).tickValues(p.domain().filter(function(u,t){if(j.length>50){return !(t%4)}else{return !(t%1)}})).orient("bottom");var f=d3.svg.axis().scale(n).orient("left");svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(g).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(t){return"rotate(-65)"});svg.append("g").attr("class","y axis").call(f).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em");var k=svg.selectAll("rect").data(j,function(t){return t.letter});if(k){k.exit().remove()}k.enter().append("rect").attr("class","bar").attr("x",function(t){return p(t.letter)}).attr("y",function(t){return height}).attr("width",p.rangeBand()).attr("height",0).on("mouseover",tip.show).on("mouseout",tip.hide);k.classed("highlight",function(t){if(t>20){return true}else{return false}});k.transition().duration(300).ease("cubic-in-out").attr("x",function(t){return p(t.letter)}).attr("y",function(t){return n(t.frequency)}).attr("width",p.rangeBand()).attr("height",function(t){return height-n(t.frequency)});var m=d3.max(j,function(t){return t.frequency});var i=d3.min(j,function(t){return t.frequency});var r=d3.mean(j,function(t){return t.frequency});var q=d3.median(j,function(t){return t.frequency});var o=d3.sum(j,function(t){return t.frequency});d3.select("#max").text(m);d3.select("#min").text(i);d3.select("#mean").text(d3.round(r,1));d3.select("#median").text(q);console.log(" ");console.log("max: "+m);console.log("min: "+i);console.log("mean: "+d3.round(r,1));console.log("median: "+q);console.log("Total: "+o);console.log("number of Bars: "+j.length)})};