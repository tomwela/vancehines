var margin={top:25,right:20,bottom:100,left:50},width=1100-margin.left-margin.right,height=640-margin.top-margin.bottom;var tip=d3.tip().attr("class","d3-tip").offset([-15,0]).html(function(a){return"<strong>Installs:</strong> <span style='color:white'>"+a.frequency+"</span><br /><center><span>"+a.letter+"<center></span>"});var svg=d3.select("#charts").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");svg.call(tip);var format=d3.time.format("%m/%d/%Y");var today=format(d3.time.day.offset(new Date(),+1));var before=format(d3.time.day.offset(new Date(),-30));d3.json("php/installs.php?type=byWeek&d1=03/01/2014&d2="+today+'"',function(f,c){var m=d3.format(",");var i=m(c.total);d3.select("#totalInstalls").text(i);var e=c.results;e.forEach(function(n){n.frequency=+n.frequency});var j=d3.scale.ordinal().domain(e.map(function(n){return n.letter})).rangeRoundBands([0,width],0.1);var h=d3.scale.linear().domain([0,d3.max(e,function(n){return n.frequency*1.2})]).range([height,0]);var b=d3.svg.axis().scale(j).orient("bottom");var a=d3.svg.axis().scale(h).orient("left");svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(b).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(n){return"rotate(-65)"});svg.append("g").attr("class","y axis").call(a).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em");svg.selectAll("rect").data(e).enter().append("rect").attr("class","bar").attr("x",function(n){return j(n.letter)}).attr("y",function(n){return h(n.frequency)}).attr("width",j.rangeBand()).attr("height",function(n){return height-h(n.frequency)}).on("mouseover",tip.show).on("mouseout",tip.hide);svg.selectAll("text").data(e).enter().append("text").text(function(n){return n.frequency}).attr("x",function(n){return j(n.letter)+0}).attr("y",function(n){return h(n.frequency)+10}).attr("width",j.rangeBand()).attr("height",function(n){return height-h(n.frequency)}).attr("font-family","sans-serif").attr("font-size","9px").attr("fill","black");var g=d3.max(e,function(n){return n.frequency});var d=d3.min(e,function(n){return n.frequency});var l=d3.mean(e,function(n){return n.frequency});var k=d3.median(e,function(n){return n.frequency});d3.select("#max").text(g);d3.select("#min").text(d);d3.select("#mean").text(d3.round(l,1));d3.select("#median").text(k);console.log(" ");console.log("max: "+g);console.log("min: "+d);console.log("mean: "+d3.round(l,1));console.log("median: "+k)});function updateData(d,c,b){switch(d){case"1":var a="byWeek";break;case"2":var a="byMonth";break;case"3":var a="byDay";break;default:console.log("default")}d3.json("php/installs.php?type="+a+"&d1="+c+"&d2="+b+'"',function(k,g){var r=d3.format(",");var n=r(g.total);d3.select("#totalInstalls").text(n);var i=g.results;i.forEach(function(s){s.frequency=+s.frequency});var o=d3.scale.ordinal().domain(i.map(function(s){return s.letter})).rangeRoundBands([0,width],0.1);var m=d3.scale.linear().domain([0,d3.max(i,function(s){return s.frequency*1.2})]).range([height,0]);var f=d3.svg.axis().scale(o).orient("bottom");var e=d3.svg.axis().scale(m).orient("left");svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(f).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(s){return"rotate(-65)"});svg.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em");svg.select(".x.axis").remove();svg.select(".y.axis").remove();var j=svg.selectAll("rect").data(i,function(s){return s.letter});j.enter().append("rect").attr("class","bar").attr("x",function(s){return o(s.letter)}).attr("y",function(s){return m(s.frequency)}).attr("width",o.rangeBand()).attr("height",function(s){return height-m(s.frequency)}).on("mouseover",tip.show).on("mouseout",tip.hide);j.exit().remove();j.transition().duration(750).attr("x",function(s){return o(s.letter)}).attr("y",function(s){return m(s.frequency)}).attr("width",o.rangeBand()).attr("height",function(s){return height-m(s.frequency)});svg.call(tip);var l=d3.max(i,function(s){return s.frequency});var h=d3.min(i,function(s){return s.frequency});var q=d3.mean(i,function(s){return s.frequency});var p=d3.median(i,function(s){return s.frequency});d3.select("#max").text(l);d3.select("#min").text(h);d3.select("#mean").text(d3.round(q,1));d3.select("#median").text(p);console.log(" ");console.log("max: "+l);console.log("min: "+h);console.log("mean: "+d3.round(q,1));console.log("median: "+p)})};