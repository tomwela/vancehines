var PopUp=function(){this.pp=new Array();this.ff={};var a=this;this.onKeyUp=function(b){var b=b||window.event;if(b.keyCode==27){var c=a.pp.pop();if(c==undefined){return}a.pp.push(c);a.hide(c);controls.stopEvent(b);if(!b.preventDefault){b.keyCode=0}}};this.onClickBody=function(d){var g=a.pp.pop();if(g==undefined){return}a.pp.push(g);d=d||window.event;var f=controls.getClientPosition(d);var c=controls.getCoordinates(g);var b=controls.getWindowScroll();if(f.x<c.left-b.x||f.x>c.right-b.x||f.y<c.top-b.y||f.y>c.bottom-b.y){if(!a.isClicked){a.hide(g)}a.isClicked=false}controls.stopEvent(d)};controls.addEvent(document,"keyup",this.onKeyUp);controls.addEvent(document,"click");this.initialize=function(e,d){if(!controls.$(e)){return}if(d){var c=controls.$("fade_"+e);if(!c){var b=parseInt(controls.getStyle(e,"zIndex"));c=document.createElement("div");c.id="fade_"+e;c.className="popup-shadow";c.style.display="none";if(b>0){c.style.zIndex=b-1}document.body.appendChild(c)}}};this.show=function(c,f,b,j,i){var g=this;if(b==undefined){b=1}if(f==undefined){f=0.5}if(this.pp.length>0&&this.pp[this.pp.length-1]==c){controls.display(c,"");if(controls.$("fade_"+c)&&f>0){controls.fade("fade_"+c,true,f)}return}if(typeof(hideBadElements)=="function"){hideBadElements()}var k=parseInt(controls.getStyle((this.pp.length>0)?this.pp[this.pp.length-1]:c,"zIndex"));if(k>0){if(this.pp.length>0){controls.$(c).style.zIndex=k+10;if(controls.$("fade_"+c)){controls.$("fade_"+c).style.zIndex=k+9}}else{if(controls.$("fade_"+c)){controls.$("fade_"+c).style.zIndex=k-1}}}if(controls.$("fade_"+c)&&f>0){controls.fade("fade_"+c,true,f)}if(j>0){this.ff[c]={time:j,opacity:f};controls.setOpacity(c,0);var e=0;var d=setInterval(function(){e+=0.1;if(e>=1){clearInterval(d)}else{controls.setOpacity(c,e)}},j/10)}if(i>0){this.ff[c]["onclose"]=setTimeout(function(){g.hide(c);for(var h=0;h<g.pp.length;h++){if(g.pp[h]==c){g.pp.splice(h,1);return}}},i)}controls.display(c,"");if(b>0){controls.centre(c)}this.pp.push(c)};this.hide=function(d){if(controls.$(d).style.display=="none"){return}if(typeof(showBadElements)=="function"){showBadElements()}if(controls.$("fade_"+d)){controls.fade("fade_"+d,false)}if(this.ff[d]){if(this.ff[d]["onclose"]){clearTimeout(this.ff[d]["onclose"])}var c=1;var b=setInterval(function(){c-=0.1;if(c<=0){clearInterval(b);controls.display(d,"none")}else{controls.setOpacity(d,c)}},this.ff[d]["time"]/10)}else{controls.display(d,"none")}a.pp.pop()}};var popup=new PopUp();